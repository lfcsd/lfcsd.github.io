<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LFCSD Days Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: 'Lexend', sans-serif;
      background: linear-gradient(135deg, #6a0dad, #8a2be2);
      color: #fff;
      min-height: 100vh;
    }

    .container { max-width: 900px; margin: auto; padding: 20px; }

    /* Login Card */
    .login-container {
      background: rgba(0,0,0,0.75);
      padding: 30px;
      border-radius: 15px;
      max-width: 400px;
      margin: 60px auto;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }

    .login-container h2 { margin-bottom: 20px; }
    .login-container input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 10px;
      border: none;
      font-family: 'Lexend', sans-serif;
    }
    .login-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: #8a2be2;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .login-btn:hover { background: #6a0dad; }

    .error { color: #ff6b6b; margin-bottom: 10px; }

    /* Admin Panel */
    .admin-panel { display: none; }
    .admin-section {
      background: rgba(0,0,0,0.5);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .admin-section h2 {
      margin-top: 0;
      border-bottom: 2px solid #8a2be2;
      padding-bottom: 8px;
    }
    .admin-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .admin-btn {
      flex: 1;
      min-width: 120px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #8a2be2;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    .admin-btn:hover { background: #6a0dad; }

    .logout-btn {
      display: block;
      margin: 20px auto;
      padding: 12px 20px;
      background: #ff6b6b;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    /* Announcement Preview */
    .announcement-preview { margin-top: 15px; border-radius: 10px; padding: 15px; background: #6a0dad; text-align: center; }
    .announcement-preview span { font-weight: bold; display: block; margin-bottom: 8px; }

    /* PWA Notifications */
    .pwa-notifications { margin-top: 15px; }
    .pwa-notifications button {
      padding: 10px 15px;
      border-radius: 10px;
      border: none;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
      margin-right: 10px;
    }
    .pwa-notifications button:hover { background: #45a049; }

    @media (max-width: 768px) {
      .admin-buttons { flex-direction: column; }
      .admin-btn { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="login-container" id="loginContainer">
    <h2>Admin Login</h2>
    <div class="error" id="errorMessage"></div>
    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit" class="login-btn">Login</button>
    </form>
  </div>

  <div class="admin-panel container" id="adminPanel">
    <!-- Current Day -->
    <div class="admin-section">
      <h2>Today's Day Controls</h2>
      <div class="admin-buttons">
        <button class="admin-btn" onclick="setDay('current', 1)">Day 1</button>
        <button class="admin-btn" onclick="setDay('current', 2)">Day 2</button>
        <button class="admin-btn" onclick="setSchedule('current','Half-Day')">Half-Day</button>
        <button class="admin-btn" onclick="setSchedule('current','2hr Delay')">2hr Delay</button>
        <button class="admin-btn" onclick="setSchedule('current','Regular Day')">Regular Day</button>
        <button class="admin-btn" onclick="resetAuto('current')">Reset to Auto</button>
      </div>
    </div>

    <!-- Next Day -->
    <div class="admin-section">
      <h2>Next Day Controls</h2>
      <div class="admin-buttons">
        <button class="admin-btn" onclick="setDay('next', 1)">Day 1</button>
        <button class="admin-btn" onclick="setDay('next', 2)">Day 2</button>
        <button class="admin-btn" onclick="setSchedule('next','Half-Day')">Half-Day</button>
        <button class="admin-btn" onclick="setSchedule('next','2hr Delay')">2hr Delay</button>
        <button class="admin-btn" onclick="setSchedule('next','Regular Day')">Regular Day</button>
        <button class="admin-btn" onclick="resetAuto('next')">Reset to Auto</button>
      </div>
    </div>

    <!-- Announcements -->
    <div class="admin-section">
      <h2>Announcements</h2>
      <textarea id="announcementText" rows="3" placeholder="Enter announcement..."></textarea>
      <input type="color" id="colorPicker" value="#6a0dad">
      <input type="text" id="announcementColor" value="#6a0dad">
      <div class="admin-buttons">
        <button class="admin-btn" onclick="setAnnouncement()">Apply</button>
        <button class="admin-btn" onclick="clearAnnouncement()">Clear</button>
      </div>
      <div class="announcement-preview" id="announcementPreview">
        <span>Preview:</span>
        <div id="previewContent">Your announcement will appear here</div>
      </div>
    </div>

    <!-- PWA Notifications -->
    <div class="admin-section pwa-notifications">
      <h2>Send PWA Notifications</h2>
      <input type="text" id="notifTitle" placeholder="Notification Title">
      <input type="text" id="notifBody" placeholder="Notification Body">
      <button onclick="sendPushNotification()">Send Notification</button>
    </div>

    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB6yxt2JX4ubnFsiYf2stfdnHeqjNySiJc",
      authDomain: "lfcsd-days.firebaseapp.com",
      projectId: "lfcsd-days",
      storageBucket: "lfcsd-days.appspot.com",
      messagingSenderId: "520576481150",
      appId: "1:520576481150:web:b08a50be7b0d15e113e52f"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Login
    document.getElementById('loginForm').addEventListener('submit', async e => {
      e.preventDefault();
      try {
        const userCredential = await auth.signInWithEmailAndPassword(
          document.getElementById('email').value,
          document.getElementById('password').value
        );
        const token = await userCredential.user.getIdTokenResult();
        if(token.claims.admin){
          document.getElementById('loginContainer').style.display='none';
          document.getElementById('adminPanel').style.display='block';
          loadAnnouncement();
        } else throw new Error("Not admin");
      } catch (err) { document.getElementById('errorMessage').textContent = err.message; }
    });

    auth.onAuthStateChanged(async user => {
      if(user){
        const token = await user.getIdTokenResult();
        if(token.claims.admin){
          document.getElementById('loginContainer').style.display='none';
          document.getElementById('adminPanel').style.display='block';
          loadAnnouncement();
        }
      }
    });

    // Admin functions
    async function updateSettings(updates, type){
      try{
        await db.collection(type==='current'?'settings':'nextDaySettings').doc('current').update({
          ...updates,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert('Updated!');
      } catch(e){ alert('Error: '+e.message); }
    }
    function setDay(type, day){ updateSettings({manualDay:day, autoMode:false}, type); }
    function setSchedule(type, schedule){ updateSettings({schedule:schedule, autoMode:schedule==='Regular Day'}, type); }
    function resetAuto(type){ updateSettings({manualDay:null, schedule:'Regular Day', autoMode:true}, type); }

    async function setAnnouncement(){
      const msg = document.getElementById('announcementText').value;
      const color = document.getElementById('announcementColor').value || '#6a0dad';
      if(!msg) return alert("Enter message");
      await db.collection("announcements").doc("current").set({
        message: msg, color: color, lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
      });
      updatePreview();
    }
    async function clearAnnouncement(){
      await db.collection("announcements").doc("current").delete();
      document.getElementById('announcementText').value='';
      document.getElementById('announcementColor').value='#6a0dad';
      updatePreview();
    }
    function updatePreview(){
      const text=document.getElementById('announcementText').value;
      const color=document.getElementById('announcementColor').value;
      document.getElementById('previewContent').textContent=text||'Your announcement will appear here';
      document.getElementById('previewContent').style.background=color||'#6a0dad';
    }
    async function loadAnnouncement(){
      const doc=await db.collection("announcements").doc("current").get();
      if(doc.exists){
        document.getElementById('announcementText').value=doc.data().message||'';
        document.getElementById('announcementColor').value=doc.data().color||'#6a0dad';
        updatePreview();
      }
    }

    function logout(){ auth.signOut(); location.reload(); }

    // PWA Push Notifications
    async function sendPushNotification(){
      const title=document.getElementById('notifTitle').value;
      const body=document.getElementById('notifBody').value;
      if(!title||!body)return alert('Enter both title and body');
      // Add notification to Firestore queue
      await db.collection('notification_outbox').add({
        title, body, sendAt: new Date(), sent:false
      });
      alert('Notification queued!');
    }
  </script>
</body>
</html>
